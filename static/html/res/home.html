<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.5.1/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.5.1/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.5.1/demo/demo.css">

    <script type="text/javascript" src="/static/jquery-easyui-1.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="/static/jquery-easyui-1.5.1/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/static/js/common.js"></script>
</head>

<body>
<table id="dg"></table>
<div id="toolbar">
    角色名称: <input id="toolbar_rolename" class="easyui-textbox" style="width:110px">
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-search" onclick="query()">查询</a>

    <div style="float:right">
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="add()">添加</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="edit()">编辑</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="destroy()">删除</a>
    </div>
</div>

<script>
    $(function () {

    });

    $('#dg').datagrid({
        url: '/roles',
        pagination: true,
        fitColumns: true,
        rownumbers:true,
        fit: true,
        toolbar: '#toolbar',
        method:'get',
        singleSelect:true,
        columns: [[
            {field: 'id', title: 'Id', sortable: true},
            {field: 'role_name', title: '角色名', width: 100, sortable: true},
            {
                field: 'create_time', title: '创建时间', width: 100, sortable: true,
                formatter: function (value, row, index) {
                    return new Date(value).format("yyyy-MM-dd hh:mm:ss");
                }
            },
            {
                field: 'update_time', title: '最后一次更新时间', width: 100, sortable: true,
                formatter: function (value, row, index) {
                    return new Date(value).format("yyyy-MM-dd hh:mm:ss");
                }
            }
        ]]
    });

    function query() {
        $('#dg').datagrid({
            queryParams : {
                role_name : $('#toolbar_rolename').val()
            }
        });
    }
</script>

<div id="dlg" class="easyui-dialog" style="width:400px"
     closed="true" buttons="#dlg-buttons" data-options="modal:true">
    <form id="fm" method="post" novalidate style="margin:0;padding:20px 50px">
        <div style="margin-bottom:20px;font-size:14px;border-bottom:1px solid #ccc">角色信息</div>
        <div style="margin-bottom:10px">
            <input name="role_name" class="easyui-textbox" required="true" label="角色名:" style="width:100%">
        </div>
    </form>
</div>
<div id="dlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" onclick="save()"
       style="width:90px">保存</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel"
       onclick="javascript:$('#dlg').dialog('close')" style="width:90px">取消</a>
</div>


<script>
    var url;
    function add() {
        $('#dlg').dialog('open').dialog('center').dialog('setTitle', '添加角色');
        $('#fm').form('clear');
        url = '/roles';
    }

    function edit() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            $('#dlg').dialog('open').dialog('center').dialog('setTitle', '编辑角色');
            $('#fm').form('load', row);
            url = '/roles/' + row.id;
        }
    }

    function save() {
        $('#fm').form('submit', {
            url: url,
            onSubmit: function () {
                if ($(this).form('validate')) {
                    $.messager.progress();
                    return true;
                }
                return false;
            },
            success: function (result) {
                $.messager.progress('close');
                var result = eval('(' + result + ')');
                if (result.ok) {
                    $('#dlg').dialog('close');        // close the dialog
                    $('#dg').datagrid('reload');    // reload the user data
                } else {
                    $.messager.show({
                        title: '系统提示',
                        msg: result.msg
                    });
                }
            }
        });
    }

    function destroy() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            $.messager.confirm('系统提醒', '您确定删除这条数据吗?', function (r) {
                if (r) {
                    $.messager.progress();
                    $.ajax({
                        url: '/roles/' + row.id,
                        type: 'DELETE',
                        dataType : 'json',
                        success: function(result) {
                            $.messager.progress('close');
                            if (result.ok) {
                                $('#dg').datagrid('reload');    // reload the user data
                            } else {
                                $.messager.show({    // show error message
                                    title: 'Error',
                                    msg: result.msg
                                });
                            }
                        }
                    });
                }
            });
        }
    }
</script>
</body>